{% extends "base.html" %}

{% block title %}Properties - Tourist Development Tax Collection{% endblock %}
{% block header %}Properties{% endblock %}

{% block content %}
<div class="toolbar">
    <form class="search-form" method="GET">
        <input type="text" name="search" placeholder="Search by address, PID, or TDT#" value="{{ search }}">
        <select name="scenario">
            <option value="">All Scenarios</option>
            <option value="1" {% if scenario_filter == 1 %}selected{% endif %}>Not registered, did not pay</option>
            <option value="2" {% if scenario_filter == 2 %}selected{% endif %}>Not registered, but paid</option>
            <option value="3" {% if scenario_filter == 3 %}selected{% endif %}>Registered, did not pay</option>
            <option value="4" {% if scenario_filter == 4 %}selected{% endif %}>Registered, paid wrong amount</option>
        </select>
        <button type="submit" class="btn btn-secondary">Filter</button>
    </form>
    <a href="{{ url_for('properties.add_property') }}" class="btn btn-primary">Add Property</a>
</div>

<div class="card">
    {% if properties %}
    <table class="data-table">
        <thead>
            <tr>
                <th>Address</th>
                <th>City</th>
                <th>Parcel ID</th>
                <th>TDT #</th>
                <th>Status</th>
                <th>Scenario</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for prop in properties %}
            <tr>
                <td><a href="{{ url_for('properties.view_property', id=prop.id) }}">{{ prop.address }}</a></td>
                <td>{{ prop.city }}</td>
                <td>{{ prop.parcel_id or '-' }}</td>
                <td>{{ prop.tdt_number or '-' }}</td>
                <td>
                    {% if prop.is_registered %}
                        <span class="badge badge-success">Registered</span>
                    {% else %}
                        <span class="badge badge-warning">Not Registered</span>
                    {% endif %}
                </td>
                <td>
                    {% if prop.compliance_scenario == 1 %}
                        <span class="badge badge-scenario-1">Not registered, did not pay</span>
                    {% elif prop.compliance_scenario == 2 %}
                        <span class="badge badge-scenario-2">Not registered, but paid</span>
                    {% elif prop.compliance_scenario == 3 %}
                        <span class="badge badge-scenario-3">Registered, did not pay</span>
                    {% elif prop.compliance_scenario == 4 %}
                        <span class="badge badge-scenario-4">Registered, paid wrong amount</span>
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td>
                    <a href="{{ url_for('properties.edit_property', id=prop.id) }}" class="btn btn-small">Edit</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="empty-state">No properties found. <a href="{{ url_for('properties.add_property') }}">Add one</a>.</p>
    {% endif %}
</div>
{% endblock %}

